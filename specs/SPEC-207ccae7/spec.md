# 機能仕様: アプリケーションバージョン表示機能

**仕様ID**: `SPEC-207ccae7`
**作成日**: 2025-10-31
**ステータス**: ドラフト
**入力**: ユーザー説明: "ヘッダーにアプリのバージョンを表示する機能。UI画面のヘッダーコンポーネントにバージョンを表示し、CLIフラグ（--version / -v）でもバージョンを出力する。package.jsonからバージョン情報を動的に取得する。"

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー 1 - CLIフラグでバージョン確認 (優先度: P1)

CLIユーザーとして、アプリケーションのバージョンを素早く確認したい。コマンドラインで `--version` または `-v` フラグを使用することで、現在インストールされているアプリケーションのバージョン番号を即座に表示できる。

**この優先度の理由**: バージョン確認はトラブルシューティングやバグレポートで最も頻繁に使用される基本的な機能であり、CLI標準の一部として優先度が最も高い。

**独立したテスト**: `claude-worktree --version` コマンドを実行することで完全にテストでき、ユーザーはバージョン情報を即座に取得できる価値を提供します。

**受け入れシナリオ**:

1. **前提条件** アプリケーションがインストールされている、**操作** `claude-worktree --version` を実行する、**期待結果** バージョン番号（例: "1.12.3"）が標準出力に表示される
2. **前提条件** アプリケーションがインストールされている、**操作** `claude-worktree -v` を実行する、**期待結果** バージョン番号が標準出力に表示され、--versionと同じ結果が得られる
3. **前提条件** アプリケーションがインストールされている、**操作** バージョンフラグを実行する、**期待結果** バージョン表示後、アプリケーションは正常終了する（他の処理は実行されない）

---

### ユーザーストーリー 2 - UIヘッダーでバージョン確認 (優先度: P2)

UIユーザーとして、アプリケーションを使用中に現在のバージョンを確認したい。メイン画面のヘッダーにバージョン情報が表示されることで、サポート問い合わせ時やバグレポート時に正確なバージョンを伝えることができる。

**この優先度の理由**: UIでのバージョン表示はユーザビリティを向上させるが、CLIフラグほど緊急性は高くない。ユーザーは通常、問題が発生した際にバージョンを確認する。

**独立したテスト**: アプリケーションのメインUIを起動し、ヘッダー部分を視覚的に確認することでテストできます。

**受け入れシナリオ**:

1. **前提条件** アプリケーションが起動している、**操作** ブランチ一覧画面を表示する、**期待結果** ヘッダーに "Claude Worktree v1.12.3" のような形式でバージョンが表示される
2. **前提条件** アプリケーションが起動している、**操作** 異なる画面（ブランチ作成画面、Worktree管理画面など）に移動する、**期待結果** すべての主要画面のヘッダーにバージョンが一貫して表示される
3. **前提条件** package.jsonのバージョンが更新されている、**操作** アプリケーションを再起動する、**期待結果** 更新されたバージョンがヘッダーに反映される

---

### エッジケース

- package.jsonが存在しない、または読み取れない場合、何が起こりますか？
  - CLIフラグ: エラーメッセージを表示するか、"バージョン情報が利用できません" のような代替メッセージを表示する
  - UIヘッダー: バージョン情報を表示しないか、"N/A" のような代替テキストを表示する
- package.jsonにバージョンフィールドが存在しない場合、何が起こりますか？
  - 同様に、適切なフォールバック処理を行う
- バージョンフォーマットが不正な場合（例: 数値ではなく文字列）、どのように処理されますか？
  - そのまま表示するか、バリデーションを行ってエラーハンドリングする

## 要件 *(必須)*

### 機能要件

- **FR-001**: システムはアプリケーション起動時またはバージョン要求時にpackage.jsonからバージョン情報を読み取らなければならない
- **FR-002**: システムは `--version` コマンドラインフラグを受け付け、バージョン番号を標準出力に表示しなければならない
- **FR-003**: システムは `-v` コマンドラインフラグを受け付け、`--version` と同じバージョン番号を標準出力に表示しなければならない
- **FR-004**: システムはバージョンフラグが指定された場合、バージョン情報を表示した後に正常終了し、他の処理を実行してはならない
- **FR-005**: システムはUIの各主要画面（ブランチ一覧、ブランチ作成、Worktree管理など）のヘッダーコンポーネントにバージョン情報を表示しなければならない
- **FR-006**: ヘッダーのバージョン表示形式は、アプリケーション名とバージョン番号を含む読みやすい形式（例: "Claude Worktree v1.12.3"）でなければならない
- **FR-007**: システムはpackage.jsonの読み取りに失敗した場合、適切なエラーハンドリングを行い、アプリケーションをクラッシュさせてはならない

### 主要エンティティ

- **バージョン情報**: package.jsonファイル内の `version` フィールドから取得される文字列。セマンティックバージョニング（major.minor.patch）形式を想定。
- **ヘッダーコンポーネント**: UIの各画面の上部に表示されるコンポーネント。タイトルとバージョン情報を含む。

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: ユーザーは `--version` または `-v` フラグを使用して、1秒以内にバージョン情報を取得できる
- **SC-002**: UIユーザーはアプリケーション起動時に、すべての主要画面のヘッダーでバージョン情報を視覚的に確認できる
- **SC-003**: 表示されるバージョン情報はpackage.jsonの `version` フィールドと100%一致する
- **SC-004**: package.json読み取りエラー時でも、アプリケーションは正常に動作し続ける（バージョン表示機能以外には影響しない）

## 制約と仮定 *(該当する場合)*

### 制約

- バージョン情報はpackage.jsonファイルに依存している
- 既存のHeaderコンポーネントの実装に基づいて拡張する必要がある
- 既存のCLI引数パース処理と統合する必要がある

### 仮定

- package.jsonはアプリケーションのルートディレクトリまたは予測可能な場所に存在する
- バージョン情報はセマンティックバージョニング形式（major.minor.patch）に従っている
- ユーザーはCLI標準の `--version` / `-v` フラグの動作を理解している
- 既存のヘッダーコンポーネント（Header.tsx）が存在し、プロップで拡張可能である

## 範囲外 *(必須)*

次の項目は、この機能の範囲外です：

- ビルド情報（コミットハッシュ、ビルド日時など）の表示
- バージョン履歴やチェンジログの表示
- 自動バージョン更新チェック機能
- バージョン情報のカスタマイズ設定
- 複数のバージョン形式のサポート（セマンティックバージョニング以外）

## セキュリティとプライバシーの考慮事項 *(該当する場合)*

- バージョン情報は公開情報であり、センシティブなデータを含まない
- package.jsonの読み取りはローカルファイルシステムに限定され、外部通信は不要
- ファイル読み取りエラーハンドリングにより、パストラバーサル攻撃などのセキュリティリスクを考慮する必要がある

## 依存関係 *(該当する場合)*

- `package.json` ファイル: バージョン情報のソース
- 既存の `utils.ts` に実装されている `getPackageVersion()` 関数（既存の実装を活用）
- 既存の `Header.tsx` コンポーネント（拡張が必要）
- 既存のCLI引数パース処理（`src/index.ts` の `main()` 関数）

## 参考資料 *(該当する場合)*

- [既存のHeaderコンポーネント実装](src/ui/components/parts/Header.tsx)
- [既存のgetPackageVersion関数](src/utils.ts)
- [CLIエントリーポイント](src/index.ts)
- [セマンティックバージョニング仕様](https://semver.org/)
