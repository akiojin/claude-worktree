# 機能仕様: Codex CLIのbunx移行

**仕様ID**: `SPEC-c0deba7e`
**作成日**: 2025-10-25
**ステータス**: ドラフト
**入力**: ユーザー説明: "Codex CLIの実行をnpxからbunxへ置き換え、/speckit.specify向け要件を整備する"

## ユーザーシナリオとテスト *(必須)*

### ユーザーストーリー 1 - Bun環境でCodexを即時起動 (優先度: P1)

開発者として、既にBunを利用している環境でCodex CLIをワンクリックで起動したい。

**この優先度の理由**: Bunを標準とするワークフローで待ち時間なくCodexを利用できるかが導入可否を決めるため。

**独立したテスト**: Bunがインストールされたクリーンな環境でCLIを起動し、エラーなくCodexセッションが開始されるかを確認する。

**受け入れシナリオ**:

1. **前提条件** Bun 1.0以降がインストール済み、**操作** codexコマンドを実行、**期待結果** bunx経由でCodexが起動し、ユーザー入力を受け付ける。
2. **前提条件** Codex CLIが追加引数付きで起動される、**操作** `resume --last` や `resume <id>` コマンドを利用、**期待結果** bunx経由でも同等に動作する。

---

### ユーザーストーリー 2 - Bun未導入環境へのガイダンス (優先度: P2)

開発者として、Bunを導入していないPCでCodexを起動しようとしたときに、最小限の手順で問題を自己解決したい。

**この優先度の理由**: bunx移行後にもっとも発生しやすい失敗パターンを迅速に解決できる必要があるため。

**独立したテスト**: Bunがインストールされていない環境でCodexを起動し、エラー内容と案内が適切かを確認する。

**受け入れシナリオ**:

1. **前提条件** Bun未導入、**操作** codexコマンドを実行、**期待結果** bunxが見つからない旨とインストール手順が日本語で提示される。
2. **前提条件** Windows端末、**操作** codexコマンドを実行、**期待結果** BunインストールとPATH更新を促す具体的な手順が表示される。

---

### ユーザーストーリー 3 - UIとドキュメントの整合性 (優先度: P3)

新規メンバーとして、CLI UIやドキュメントの案内が実際の実行方法と一致していてほしい。

**この優先度の理由**: 表記揺れや古い記述が残ると学習コストが増大するため。

**独立したテスト**: 対話型UIと関連ドキュメントを確認し、`bunx`が一貫して案内されているかを検証する。

**受け入れシナリオ**:

1. **前提条件** Codex選択メニューを表示、**操作** 候補一覧を確認、**期待結果** 説明文にbunxでの実行が明記されている。
2. **前提条件** トラブルシューティングページを参照、**操作** bunx関連セクションを確認、**期待結果** Windows向けの対処がbunx前提で説明されている。

---

### エッジケース

- Bunのバージョンが1.0未満の場合、互換性のない挙動を検出しユーザーに更新を促す必要があるか。
- 既存環境にNode/npmのみがある場合でも、Bun導入手順を案内するメッセージで十分か。

## 要件 *(必須)*

### 機能要件

- **FR-001**: Codex CLIは`@openai/codex`を`bunx`コマンドで起動しなければならない。
- **FR-002**: `bunx`が見つからない場合、Bunの入手方法とPATH更新手順を含むエラーメッセージを表示しなければならない。
- **FR-003**: Codex CLIの`resume --last`および`resume <id>`コマンドはbunx実行でも期待どおりに動作しなければならない。
- **FR-004**: 対話型UIのCodex説明文は`bunx @openai/codex@latest`表記を表示しなければならない。
- **FR-005**: トラブルシューティングドキュメントはbunx前提の手順に更新され、Windows固有の案内を含めなければならない。

### 主要エンティティ *(機能がデータを含む場合は含める)*

- **Codex起動コマンド**: bunxを通じてCodex CLIを呼び出す操作。利用可能なモードや追加引数を保持する。
- **ユーザー環境**: BunおよびPATH設定の有無を含むローカル開発環境。エラーハンドリングとガイダンスの対象。

## 成功基準 *(必須)*

### 測定可能な成果

- **SC-001**: Bun 1.0以降がインストールされた環境でCodex起動コマンドを発行すると、エラーなくプロセスが開始されること。
- **SC-002**: Bun未導入環境で起動した際、ユーザーが追加情報なしでBun導入手順を理解できるメッセージが表示されること。
- **SC-003**: 対話型UIおよび関連ドキュメントを検索した際、`npx`表記が残存せず`bunx`表記に統一されていること。
- **SC-004**: `resume --last`や`resume <id>`を含むコマンド実行時、bunx移行による振る舞いの差異が検出されないこと。

## 制約と仮定 *(該当する場合)*

### 制約

- Bun 1.0.0以上がユーザー環境にインストールされていることを前提に最適化する。
- `@openai/codex`パッケージのbunx実行が公式にサポートされていること。

### 仮定

- ユーザーは既にBunの導入を許容できる（Node/npmしか利用できない環境は対象外）。
- 既存のCodex関連機能はbunx実行により追加の権限設定を必要としない。

## 範囲外 *(必須)*

次の項目は、この機能の範囲外です：

- Claude Code CLIの起動方式をbunxへ変更すること。
- Bun自体のインストール自動化スクリプトを提供すること。
- Codex CLIのバージョン固定や機能拡張。

## セキュリティとプライバシーの考慮事項 *(該当する場合)*

- Bun導入による追加権限要求は発生しないため、新たなセキュリティリスクは想定していない。
- エラーメッセージには機密情報（パスなど）を含めず、一般的な手順のみを記載する。

## 依存関係 *(該当する場合)*

- Bun公式配布チャネル（brew、curlスクリプト等）。
- `@openai/codex` npmパッケージの継続的提供。

## 参考資料 *(該当する場合)*

- プロジェクトREADME内のSpec Kitワークフロー説明。
- Bun公式ドキュメント（https://bun.sh/docs/cli/bunx）。
