# 機能仕様書: Codex CLI対応（worktree起動時のツール選択）

**機能ブランチ**: `001-codex-cli-worktree`  
**作成日**: 2025-01-06  
**ステータス**: ドラフト  
**入力**: ユーザー説明: "Codex CLIにも対応したい。worktreeで起動時にClaude CodeかCodex CLIを選択できるようにする。"

## 実行フロー (main)
```
1. 入力からユーザー説明を解析
   → 空の場合: ERROR "機能説明が提供されていません"
2. 説明から主要概念を抽出
   → 識別: アクター、アクション、データ、制約
3. 不明確な側面ごとに:
   → [要確認: 具体的な質問]でマーク
4. ユーザーシナリオ＆テストセクションを埋める
   → 明確なユーザーフローがない場合: ERROR "ユーザーシナリオを判断できません"
5. 機能要件を生成
   → 各要件はテスト可能でなければならない
   → 曖昧な要件をマーク
6. 主要エンティティを識別（データが関与する場合）
7. レビューチェックリストを実行
   → [要確認]がある場合: WARN "仕様に不確実性があります"
   → 実装詳細が見つかった場合: ERROR "技術詳細を削除してください"
8. 戻り値: SUCCESS (仕様は計画準備完了)
```

---

## ⚡ クイックガイドライン
- ✅ ユーザーが何を必要とし、なぜ必要かに焦点を当てる
- ❌ 実装方法を避ける（技術スタック、API、コード構造なし）
- 👥 開発者ではなくビジネス関係者向けに書く

### セクション要件
- **必須セクション**: すべての機能で完成させる必要がある
- **オプションセクション**: 機能に関連する場合のみ含める
- セクションが適用されない場合は、完全に削除する（"N/A"として残さない）

### AI生成用
ユーザープロンプトからこの仕様を作成する際:
1. **すべての曖昧さをマーク**: 仮定が必要な場合は[要確認: 具体的な質問]を使用
2. **推測しない**: プロンプトが何かを指定していない場合（例：認証方法なしの「ログインシステム」）、マークする
3. **テスター思考**: 曖昧な要件はすべて「テスト可能で明確」のチェックリスト項目に失敗すべき
4. **一般的な詳細不足エリア**:
   - ユーザータイプと権限
   - データ保持/削除ポリシー
   - パフォーマンス目標とスケール
   - エラー処理動作
   - 統合要件
   - セキュリティ/コンプライアンスニーズ

---

## ユーザーシナリオ＆テスト *(必須)*

### 主要ユーザーストーリー
開発者がclaude-worktreeを起動する際に、プロジェクトの要件や個人の好みに応じて、使用するAIアシスタントツール（Claude CodeまたはCodex CLI）を選択できるようにする。これにより、開発者は状況に応じて最適なツールを柔軟に使い分けることができる。

### 受け入れシナリオ
1. **前提** 開発者がclaude-worktreeコマンドを実行する、**操作** 起動プロセスが開始される、**結果** AIツール選択画面が表示される
2. **前提** 選択画面が表示されている、**操作** 開発者がClaude Codeを選択する、**結果** Claude Codeモードでclaude-worktreeが起動する
3. **前提** 選択画面が表示されている、**操作** 開発者がCodex CLIを選択する、**結果** Codex CLIモードでclaude-worktreeが起動する
4. **前提** 選択画面が表示されている、**操作** 開発者がqキーを押す、**結果** claude-worktreeの起動が中止され、"Operation cancelled"メッセージが表示される
5. **前提** 開発者が以前に選択を行っている、**操作** 再度claude-worktreeを起動する、**結果** [要確認: 前回の選択を記憶すべきか、毎回選択を求めるべきか？]

### エッジケース
- 無効な入力（例：存在しない選択肢）が入力された場合の動作は？
- [要確認: 選択のタイムアウトは必要か？必要な場合、デフォルト動作は？]
- Codex CLIが環境にインストールされていない場合の動作は？
- 設定ファイルが破損している、または読み取れない場合の動作は？
- 複数のclaude-worktreeインスタンスを同時に起動する場合の動作は？

## 要件 *(必須)*

### 機能要件
- **FR-001**: システムはclaude-worktree起動時にAIアシスタントツールの選択インターフェースを提供しなければならない
- **FR-002**: システムはClaude CodeとCodex CLIの2つの選択肢を明確に表示しなければならない
- **FR-003**: ユーザーは提供された選択肢から1つのツールを選択できなければならない
- **FR-004**: システムは選択されたツールでclaude-worktree環境を正しく初期化しなければならない
- **FR-005**: ユーザーは選択操作をキャンセルしてclaude-worktreeの起動を中止できなければならない
- **FR-006**: システムは無効な入力に対して理解しやすいエラーメッセージを表示しなければならない
- **FR-007**: システムはCodex CLIの利用可能性を確認し、利用不可の場合は選択肢を無効化し、必要に応じて警告を表示する
- **FR-008**: システムは選択履歴を恒久保存しない。両方利用可能な場合は毎回選択を促し、片方のみ利用可能な場合は自動選択する
- **FR-009**: システムはコマンドラインオプション `--tool <claude|codex>` により直接ツールを指定できるようにする
- **FR-010**: システムは選択プロセス中に各ツールの説明を表示する

### 主要エンティティ *(データが関与する場合含める)*
- **ツール選択**: ユーザーが選択したAIアシスタントツールの種類（Claude CodeまたはCodex CLI）
- **選択設定**: デフォルトは「保存しない」。両方可用時は毎回選択、片方のみ可用時は自動選択
- **ツール状態**: 各ツールの利用可能性と準備状態

---

## レビュー＆受け入れチェックリスト
*ゲート: main()実行中に自動チェックが実行される*

### コンテンツ品質
- [x] 実装詳細なし（言語、フレームワーク、API）
- [x] ユーザー価値とビジネスニーズに焦点
- [x] 非技術的ステークホルダー向けに記述
- [x] すべての必須セクションが完成

### 要件の完全性
- [x] [要確認]マーカーが残っていない
- [x] 要件がテスト可能で明確
- [x] 成功基準が測定可能
- [x] スコープが明確に境界設定されている
- [x] 依存関係と前提条件が識別されている

---

## 実行ステータス
*処理中にmain()によって更新される*

- [x] ユーザー説明が解析された
- [x] 主要概念が抽出された
- [x] 曖昧さがマークされた（解消済み）
- [x] ユーザーシナリオが定義された
- [x] 要件が生成された
- [x] エンティティが識別された
- [x] レビューチェックリストが合格した

---
