# タスク: ブランチ選択カーソル視認性向上

**入力**: `specs/SPEC-822a2cbf/` の仕様および計画ドキュメント
**前提条件**: plan.md（完了）、spec.md、checklists/requirements.md

## フェーズ0: 調査

- [ ] **T001** [P] [共通] `src/ui/prompts.ts` の `selectBranchWithShortcuts` 描画ロジックを読み、選択行の文字列生成箇所を把握
- [ ] **T002** [P] [共通] `src/ui/display.ts` のヘッダーテキストとガイダンス出力を確認し、更新影響範囲を特定
- [ ] **T003** [共通] `chalk` のサポートレベル判定方法（`chalk.supportsColor` など）を確認し、モノクロ端末での挙動を整理

## フェーズ1: ユーザーストーリー1 - 誤操作なくブランチを選びたい (P1)

- [ ] **T101** [US1] `createBranchTable` 相当の表示ロジックをリスト形式へ刷新し、アイコン列＋ブランチ名のみの構造を実装
- [ ] **T102** [US1] アイコン列（種別・ワークツリー・変更状態）と配置インジケータ枠（左=L、右=R、リモートのみ=☁）の固定幅整形を実装し、ブランチ名の開始位置を揃える
- [ ] **T103** [US1] カラー有効時は行全体を背景色で反転、無効時は `>`（スペース付き） プレフィックスのみで強調する処理を `src/ui/prompts.ts` に実装
- [ ] **T104** [P] [US1] 新フォーマットのユニットテストを追加し、カラー／モノクロ双方でアイコン列とパディングが崩れないことを検証

## フェーズ2: ユーザーストーリー2 - 低コントラスト環境でも判別したい (P2)

- [ ] **T201** [US2] Local/Remote 行色（緑/青）とモノクロフォールバックを共存させるロジックを実装
- [ ] **T202** [US2] フォールバック表示・配色を検証するテスト（カラー無効モードのモック含む）を追加
- [ ] **T203** [P] [US2] 大量ブランチ・長いブランチ名を想定した手動/自動テストで整列と視認性をレビュー

## フェーズ3: ユーザーストーリー3 - ナビゲーション操作を学習したい (P3)

- [ ] **T301** [US3] `src/ui/prompts.ts` のガイダンスをアイコン＋行色表記に合わせて簡潔に調整
- [ ] **T302** [US3] README.ja.md や関連ドキュメントにアイコンの意味と行色の凡例を追加
- [ ] **T303** [US3] ショートカット遷移→復帰時に新フォーマットが維持されることを手動テストで確認
- [ ] **T304** [P] [US3] E2E/統合テストの期待文字列を新フォーマットに更新

## フェーズ4: 統合と検証

- [ ] **T401** [統合] CLI を実行し、カラー有効/無効環境で上下キー・ショートカット遷移・復帰をエンドツーエンド検証
- [ ] **T402** [統合] 新旧描画差分による表示崩れや幅超過がないか確認し、必要に応じてスナップショットやスクリーンショットを更新
- [ ] **T403** [ドキュメント] 変更内容を CHANGELOG.md にドラフト記載し、リリース準備情報を整理

## メモ

- [P] タスクは並列実行可能。その他は順序依存があるため上から着手。
- テストは実装直後に追加し、`bun run test` での回帰確認を想定。
