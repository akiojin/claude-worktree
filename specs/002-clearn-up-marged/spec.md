# 機能仕様: Clean up merged PRs コマンドの修正

**機能ブランチ**: `002-clearn-up-marged`  
**作成日**: 2025-01-06  
**ステータス**: Draft  
**入力**: ユーザー説明: "メインメニューでClearn up marged PRsが正常動作しない"

## 実行フロー（main）
```
1. 入力からユーザー説明を解析
   → "Clean up merged PRs" メニュー項目の動作不良を確認
2. 説明から主要概念を抽出
   → 識別: メインメニュー、Clean up merged PRs機能、正常動作しない状態
3. 不明点があるたびに:
   → [NEEDS CLARIFICATION: 具体的なエラーメッセージや症状は何か？]
   → [NEEDS CLARIFICATION: どの時点で動作が停止するか？]
   → [NEEDS CLARIFICATION: 期待される正常な動作は何か？]
4. ユーザーシナリオ & テストの節を埋める
   → マージ済みPRのブランチをクリーンアップする基本フローを定義
5. 機能要件を生成
   → 各要件はテスト可能であること
   → 曖昧な要件には印を付ける
6. 主要エンティティを特定（データを扱う場合）
7. レビューチェックリストを実行
   → [NEEDS CLARIFICATION] が残る場合: WARN "仕様に不確実性があります"
   → 実装の詳細が含まれる場合: ERROR "技術的詳細を除去してください"
8. 戻り値: SUCCESS（計画準備が整った仕様）
```

---

## ⚡ クイックガイド
- ✅ ユーザーが何を必要とし、なぜ必要かに集中
- ❌ どう実装するかは避ける（技術スタック、API、コード構成は記載しない）
- 👥 対象はビジネス関係者であり、開発者ではない

### セクション要件
- **必須セクション**: すべての機能で必ず記入
- **任意セクション**: 該当する場合のみ含める
- 該当しないセクションは完全に削除（"N/A" のまま残さない）

### AI 生成用の指針
ユーザープロンプトからこの仕様を作成する場合:
1. **すべての曖昧さに印を付ける**: 前提が必要な箇所には [NEEDS CLARIFICATION: 具体的な質問] を用いる
2. **推測しない**: プロンプトに未記載の事項（例: 認証方式のない「ログイン機構」など）は必ず印を付ける
3. **テスター視点で考える**: 曖昧な要件は「テスト可能で一義的」のチェックに落ちるべき
4. **典型的に不足しがちな領域**:
   - ユーザー区分と権限
   - データ保持/削除ポリシー  
   - パフォーマンス目標とスケール
   - エラーハンドリングの振る舞い
   - 連携要件
   - セキュリティ/コンプライアンス要件

---

## ユーザーシナリオ & テスト（必須）

### 主要ユーザーストーリー
開発者がgit worktreeを使用して複数のPull Requestで作業している際、マージ済みのPRに関連するworktreeブランチを効率的にクリーンアップしたい。メインメニューから「Clean up merged PRs」を選択することで、マージ済みのPRに関連するローカルブランチを自動的に検出し、安全に削除できるようにする。

### 受け入れシナリオ
1. **前提** 複数のworktreeがあり、一部のPRがマージ済み、**もし** ユーザーがメインメニューから「Clean up merged PRs」を選択、**ならば** マージ済みPRのブランチ一覧が表示され、削除対象を選択できる
2. **前提** マージ済みのPRブランチが存在する、**もし** ユーザーが削除を実行、**ならば** 選択したブランチとworktreeが安全に削除される
3. **前提** マージ済みのPRブランチが存在しない、**もし** ユーザーが「Clean up merged PRs」を選択、**ならば** 適切なメッセージが表示される

### エッジケース
- [削除対象のブランチに未コミットの変更がある] のとき何が起きるか？ [NEEDS CLARIFICATION: 強制削除オプションを提供するか、警告のみか？]
- システムは [GitHubとの接続エラー] をどう扱うか？ [NEEDS CLARIFICATION: オフラインモードでの動作は？]
- [現在チェックアウト中のブランチが削除対象] のとき何が起きるか？

## 要件（必須）

### 機能要件
- **FR-001**: システムは マージ済みのPRに関連するローカルブランチを検出できる を満たすこと
- **FR-002**: システムは 検出したマージ済みPRブランチの一覧を表示する を満たすこと  
- **FR-003**: ユーザーは 削除するブランチを選択できる こと
- **FR-004**: システムは 選択されたブランチとそのworktreeを安全に削除する こと
- **FR-005**: システムは 削除処理の進捗と結果を表示する こと
- **FR-006**: システムは [NEEDS CLARIFICATION: リモートリポジトリとの同期方法 - GitHub API、git fetch、その他？] でマージ状態を確認すること
- **FR-007**: システムは [NEEDS CLARIFICATION: エラー発生時の具体的な復旧手順] を提供すること
- **FR-008**: ユーザーは [NEEDS CLARIFICATION: 削除を取り消す機能が必要か？] こと

### 主要エンティティ（データを扱う場合に記載）
- **Worktree**: git worktreeの情報（パス、ブランチ名、状態）
- **Pull Request**: PRの情報（番号、タイトル、マージ状態）
- **Branch**: ブランチの情報（名前、リモート追跡状態、最終コミット）

---

## レビュー & 受け入れチェックリスト
*GATE: main() 実行時に自動チェック*

### コンテンツ品質
- [ ] 実装の詳細（言語・フレームワーク・API）を含まない
- [ ] ユーザー価値とビジネスニーズに焦点
- [ ] 非技術者向けに記述されている
- [ ] 必須セクションがすべて埋まっている

### 要件の完全性
- [ ] [NEEDS CLARIFICATION] マーカーが残っていない
- [ ] 要件はテスト可能かつ一義的である  
- [ ] 成功基準は測定可能
- [ ] スコープが明確に境界付けられている
- [ ] 依存関係と前提が特定されている

---

## 実行ステータス
*処理中に main() により更新*

- [x] ユーザー説明を解析
- [x] 主要概念を抽出
- [x] 曖昧点にマーカー付与
- [x] ユーザーシナリオを定義
- [x] 要件を生成
- [x] エンティティを特定
- [ ] レビューチェックリストを通過

---