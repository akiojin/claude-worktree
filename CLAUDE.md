# CLAUDE.md

このファイルは、Claude Code (claude.ai/code) がこのリポジトリでコードを扱う際のガイダンスを提供します。

## 開発指針

### 🎯 企画書の価値を実現

**最重要**: 「(仮)AI小説家」はAI技術を活用した革新的な月額制読書アプリです：

1. **毎日新作追加**: AIが自動生成する多様なジャンルの小説を毎日3～5作品配信
2. **多ジャンル対応**: ミステリー、SF、ファンタジー、恋愛、ホラー、純文学など幅広いジャンル
3. **高品質な読書体験**: 月額980円で月10冊まで楽しめる手頃な価格設定
4. **優れた文学品質**: 最新AI技術による高品質な文章生成と品質管理システム

### 🛠️ 技術実装指針

- **設計・実装は複雑にせずに、シンプルさの極限を追求してください**
- **ただし、企画書で定義された読書体験の品質は決して妥協しない**
- 実装はシンプルに、読書体験は最高品質に
- 文学的品質と読書体験を技術的複雑さより優先
- AI生成の効率性と品質のバランスを重視

### 📝 設計ガイドライン

- 設計に関するドキュメントには、ソースコードを書かないこと

## 開発品質

### 完了条件

- エラーが発生している状態で完了としないこと。必ずエラーが解消された時点で完了とする。

## プロジェクト情報

### ビルドコマンド

```bash
npm run build    # Next.jsプロダクションビルド
npm run dev      # 開発サーバー起動
```

### テストコマンド

```bash
npm run type-check  # TypeScript型チェック
npm run lint        # ESLint実行
```

### 主要な依存関係

- **Next.js 15.4.0**: React フレームワーク  
- **TypeScript 5.7.2**: 型安全な開発
- **AI統合**: OpenAI, Anthropic, Google Gemini
- **認証**: NextAuth.js v5
- **決済**: Stripe
- **DB**: AWS DynamoDB

### アーキテクチャ

- **フロントエンド**: Next.js App Router + TypeScript
- **バックエンド**: API Routes + AI統合
- **データ**: DynamoDB + ElastiCache
- **認証**: NextAuth.js v5

## 開発ワークフロー

### 基本ルール

- 作業（タスク）を完了したら、変更点をコミットログに追加して、コミット＆プッシュを必ず行う
- 作業（タスク）は、最大限の並列化をして進める
- 作業（タスク）は、最大限の細分化をしてToDoに登録する
- 作業（タスク）の開始前には、必ずTodoWriteでToDoを登録した後に作業を開始する
- 作業（タスク）の完了後は、作業内容をプッシュして、必ずPRを出す。
- 作業（タスク）を出す前には、必ずdevelopの最新版をマージする。
- 作業（タスク）は、忖度なしで進める
- 作業（タスク）のPRはmainブランチへは禁止、developに対して行う

## GitHub Issues更新ルール

**全てのタスクにおいて、以下のGitHub Issues更新ルールに従ってIssueを更新すること**

### タスク開始時の必須アクション

1. **Assignee設定**
   - 作業開始時に自分をAssigneeに設定
   - 複数人で作業する場合は全メンバーをAssigneeに追加

2. **ラベル更新**
   - `in-progress` ラベルを追加
   - 該当する種別ラベル（`frontend`, `backend`, `ai`, `docs`等）を追加

3. **開始コメント記録**

   ```markdown
   ## 🚀 作業開始

   **開始日時**: 2025-06-29 10:00  
   **担当者**: @username  
   **予定完了日**: 2025-06-30  

   ### 作業計画
   - [ ] タスク1の詳細
   - [ ] タスク2の詳細
   - [ ] テスト・検証

   ### 関連Issue/PR
   - 関連Issue: #123
   - 依存Issue: #456
   ```

### 作業中の進捗更新

1. **定期的な進捗報告（最低1日1回）**

   ```markdown
   ## 📈 進捗報告 (2025-06-29)

   ### 完了した作業
   - ✅ API エンドポイント実装完了
   - ✅ 基本的なテストケース追加

   ### 現在の作業
   - 🔄 フロントエンド統合作業中

   ### 次の予定
   - 📋 UIコンポーネントの実装
   - 📋 E2Eテストの実行

   ### 課題・ブロッカー
   - ⚠️ API レスポンス形式について要確認 → @reviewer
   ```

2. **問題発生時の即座報告**

   ```markdown
   ## ⚠️ 問題報告

   **発生日時**: 2025-06-29 15:30  
   **問題内容**: TypeScript型エラーが解決できない  
   **影響範囲**: フロントエンド実装全体  
   **対応方針**: 設計見直しが必要かもしれません  

   **詳細**:
   ```typescript
   // エラーの詳細コードを記載
   ```

   **支援要請**: @senior-developer のレビューをお願いします

   ```

### タスク完了時の必須アクション

1. **完了報告**

   ```markdown
   ## ✅ タスク完了報告

   **完了日時**: 2025-06-30 16:00  
   **最終担当者**: @username  

   ### 実装内容
   - ✅ `/api/ai/generate-story` エンドポイント実装
   - ✅ レート制限機能追加
   - ✅ エラーハンドリング強化

   ### テスト結果
   - ✅ 単体テスト: 全て通過
   - ✅ 型チェック: エラーなし
   - ✅ Lint: 問題なし
   - ✅ 手動テスト: 正常動作確認

   ### 関連PR
   - PR #123: バックエンドAPI実装

   ### 注意事項・引き継ぎ
   - フリープランのレート制限は月5回に設定
   - 今後の拡張時は `RATE_LIMITS` 設定を変更
   ```

2. **品質チェック完了の確認**
   - [ ] npm run type-check 通過
   - [ ] npm run lint 通過  
   - [ ] 関連テスト全て通過
   - [ ] 手動動作確認完了

3. **Issue クローズ**
   - 上記完了報告後、Issue を Close
   - 関連するPRがある場合はリンクを確認

### ラベル使用ルール

#### 進捗状態ラベル

- `needs-triage`: 新規Issue、内容整理が必要
- `ready`: 作業開始可能
- `in-progress`: 作業中
- `needs-review`: レビュー待ち
- `blocked`: 他の作業待ち・問題発生
- `completed`: 完了（クローズ前の最終確認）

#### 優先度ラベル

- `priority:critical`: 緊急対応必要
- `priority:high`: 高優先度
- `priority:medium`: 通常優先度
- `priority:low`: 低優先度

#### 種別ラベル

- `type:feature`: 新機能開発
- `type:bug`: バグ修正
- `type:enhancement`: 機能改善
- `type:docs`: ドキュメント
- `type:refactor`: リファクタリング

#### 技術領域ラベル

- `frontend`: フロントエンド
- `backend`: バックエンド
- `ai`: AI統合
- `database`: データベース
- `security`: セキュリティ
- `performance`: パフォーマンス

### エスカレーションルール

#### 即座にエスカレーションが必要な場合

1. **クリティカルなバグ発見**
   - プロダクション環境に影響する可能性がある場合
   - セキュリティ脆弱性を発見した場合

2. **ブロッカーが解決できない**
   - 1日以上作業が停止している場合
   - 他チームとの調整が必要な場合

3. **仕様変更が必要**
   - 既存設計との矛盾を発見した場合
   - パフォーマンス要件を満たせない場合

#### エスカレーション方法

```markdown
## 🚨 エスカレーション

**レベル**: Critical/High/Medium  
**理由**: 具体的な理由  
**影響範囲**: プロジェクト全体/特定機能  
**対応期限**: 2025-06-30  

**詳細**:
問題の詳細な説明

**提案**: 
可能な解決策があれば記載

**メンション**: @project-manager @team-lead
```

## コミュニケーションガイドライン

- 回答は必ず日本語

## 外部連携

### GitHub操作について
- **重要**: GitHub MCPは使用禁止です
- GitHub操作は**GitHub CLI (`gh`)コマンド**を直接Bashツールで実行してください
- 例: `gh pr create`, `gh issue create`, `gh repo-config apply`など

### 利用可能なMCPツール
- `context7` MCP を使用して、最新のNext.js、Node.js、およびその他のライブラリを確認してください。
- `google-search`MCPウェブ検索を使用して、最新の解決策を検索できます。
- `microsoft.docs.mcp`MCPを使用して、最新の.NETなどの、マイクロソフトのドキュメントを確認してください。
- `awslabs.aws-documentation`MCPを使用して、最新のAWSのドキュメントを確認してください。
- `openai`MCPを使用して、画像生成をすることができます。
- `model-hub`MCPを使用して、最新のモデルを取得することができます。

## ドキュメント管理

- ドキュメントはルートディレクトリに配置してはいけない。必ずdocs/配下に配置する

## コードクオリティガイドライン

- マークダウンファイルはmarkdownlintでエラー及び警告がない状態にする
- コミットログはcommitlintに対応する

## 開発ガイドライン

- 既存のファイルのメンテナンスを無視して、新規ファイルばかり作成するのは禁止。既存ファイルを改修することを優先する。

## ドキュメント作成ガイドライン

- README.mdには設計などは書いてはいけない。プロジェクトの説明やディレクトリ構成などの説明のみに徹底する。設計などは、適切なファイルへのリンクを書く。

## インフラストラクチャガイドライン

- GitHub Actionsで使用するホストランナーはself-hosted/macOSのみ許可
- self-hostedランナーは組織に登録されているため、常にself-hostedを使用する

## ブランチ管理

- ブランチ保護ルールの更新は.github/config/以下のファイルを更新して、`gh repo-config apply`で行う。
- ブランチ保護ルールは`gh repo-config apply`で行う。

## AI関連メモリ

- AIプロンプト設計が、動的生成に必要なプロンプトの設計です。

## メモリ

- プランモードを承認後は、必ず適切なブランチを作成して作業を進めること
